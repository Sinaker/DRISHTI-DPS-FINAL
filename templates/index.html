<!DOCTYPE html>
<html>

<head>
    <title>DPS</title>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet" />
        
    <link rel="stylesheet" href="../static/style.css" />
</head>

<body>
    <div class="container">
        <div class="navbar-left">
            <div class="dropdown">
                <div class="select">
                    <span class="selected">GPTCure </span>
                    <div class="caret"></div>
                </div>
                <ul class="menu">
                    <li class="active">GPTCure</li>
                    <li>GPTCure Advanced</li>
                </ul>
            </div>
        </div>
        <div class="navbar-right">
            <div class="settings"><a href="/signup"><span class="material-symbols-outlined"><span class="material-symbols-outlined">Logout</span>
            </a></div>
        </div>
    </div>

    <!-- Sidebar toggle button -->
    <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>

    <!-- Sidebar for storing chat history -->
    <div class="sidebar" id="sidebar">
        <h2>History</h2>
        <!-- <div class="block"></div> -->
        <ul id="historyList">
            <li></li>
        </ul>
    </div>

    <div class="container-main" id="mainContent">
        <div class="greeting">
            <a class="animated-text">Hello, {{ user_name }}</a> <br />
            How can I help you today?
        </div>

        <div class="suggestions">
            <div class="suggestion">
                <p>Can you tell me how you're feeling today? </p>
            </div>
            <div class="suggestion">
                <p>What symptoms are you experiencing? </p>
            </div>
            <div class="suggestion">
                <p>Have you been feeling fatigued or unusually tired? </p>
            </div>
            <div class="suggestion">
                <p>Do you have a fever or chills?</p>
            </div>
        </div>
    </div>
    <div class="prediction">
    </div>
    <div class="footer">
        <div class="prompt-input">
            <form action="/predict" method="POST" id="promptForm">
                <input type="text" id="prompt" name="prompt" placeholder="Enter a prompt here" />
                <button type="submit" class="submit">Submit</button>
            </form>
        </div>

        <p>
            GPTCure may display inaccurate info, including about people, so double-check its responses.
        </p>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Attach an event listener to the form
        $("#promptForm").on("submit", function (event) {
            event.preventDefault(); // Prevent the form from submitting the traditional way

            // Get the user input
            let userInput = $("#prompt").val();

            // Send an AJAX request to the Flask server
            $.ajax({
                url: "/predict", // Flask route
                type: "POST",
                data: $(this).serialize(), // Send form data
                success: function (response) {
                    console.log(response);

                    // Create a new div to hold the input and output
                    let newEntry = document.createElement('div');
                    newEntry.classList.add('entry');

                    // Create an element for user input
                    let inputDiv = document.createElement('div');
                    inputDiv.classList.add('input');
                    inputDiv.innerText = `You: ${userInput}`;

                    // Create an element for the response
                    let outputDiv = document.createElement('div');
                    outputDiv.classList.add('output');
                    outputDiv.innerText = `Response: ${response}`;

                    // Append input and output to the new entry
                    newEntry.appendChild(inputDiv);
                    newEntry.appendChild(outputDiv);

                    // Append the new entry to the prediction div
                    document.querySelector('.prediction').appendChild(newEntry);
                    addToHistory(userInput);

                    // Clear the form fields after a successful response
                    $("#promptForm")[0].reset();
                    $("input").blur();
                },
                error: function () {
                    // Handle any errors here
                    let errorDiv = document.createElement('div');
                    errorDiv.innerText = "An error occurred while processing your request.";
                    document.querySelector('.prediction').appendChild(errorDiv);
                },
            });
        });

        // Function to add a new entry to the history list
        function addToHistory(userInput) {
            const historyList = document.getElementById('historyList');

            // Create a new list item element
            const newListItem = document.createElement('li');
            newListItem.innerText = userInput;

            // Add a click event to the list item
            newListItem.addEventListener('click', function () {
                alert('You clicked: ' + userInput);
            });

            // Append the new list item to the history list
            historyList.appendChild(newListItem);
        }

        // Fetch and populate the sidebar with user data
        $.ajax({
            url: '/get_user_data',
            type: 'GET',
            success: function (data) {
                // data is assumed to be a list of entries
                populateSidebar(data);
            },
            error: function () {
                console.error('Failed to fetch user data');
            }
        });

        function populateSidebar(entries) {
            const sidebar = document.getElementById('historyList');
            entries = entries[0]
            sidebar.innerHTML = ''; // Clear existing entries

            // Iterate over each entry in the data
            entries.forEach(entry => {
                // Create a list item for each entry
                const listItem = document.createElement('li');
                // Construct the text for the list item including the session ID and user prompt
                listItem.innerText = `Date: ${entry[0]}`;
                listItem.addEventListener('click', function () {
                    alert('Clicked: ' + listItem.innerText);
                });
                sidebar.appendChild(listItem);
            });
        }

        // Sidebar toggle button functionality
        $('#sidebarToggle').on('click', function () {
            $('.container').toggleClass('shifted');
        });
    });
</script>




    <script src="../static/script.js"></script>
</body>

</html>